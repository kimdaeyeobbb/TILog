<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ECMAScript6</title>
  </head>
  <body>
    <!-- http://localhost:3000/exam21로 확인 -->
    <!-- springedu2 서버를 기동시켜야 제대로 작동함 -->
    <h1>AJAX 기술로 REST API 요청(CORS)</h1>
    <hr />
    <button onclick="getAll()">GET(ALL)</button>
    <button onclick="getOne()">GET(One)</button>
    <button onclick="postData()">POST</button>
    <button onclick="deleteData()">DELETE</button>
    <script>
      /*  ajaxrequest -> 클래스 정의와 객체 생성을 동시에 한 것 */
      // 한번 할당한 객체에 새로운 멤버을 추가할수는 있지만, 담고있는 객체외의 다른 객체를 다시 담을 수는 없음
      const ajaxrequest = {
        // 객체를 만들어서 처리
        get(url) {
          return fetch(url);
        },
        getOne(url) {
          return fetch(url);
        },
        post(url, payload) {
          return fetch(url, {
            method: "POST",
            headers: { "content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
        },
        delete(url) {
          return fetch(url, { method: "DELETE" });
        },
      };

      function getAll() {
        ajaxrequest
          .get("http://localhost:8088/boards")
          .then((response) => {
            if (!response.ok) throw new Error(response.statusText);
            return response.json();
          })
          .then((boards) => console.log(boards))
          .catch((err) => console.error(err));
      }

      function getOne() {
        ajaxrequest
          .get("http://localhost:8088/boards/1")
          .then((response) => {
            if (!response.ok) throw new Error(response.statusText);
            return response.json();
          })
          .then((board) => console.log(board))
          .catch((err) => console.error(err));
      }

      function postData() {
        ajaxrequest
          .post("http://localhost:8088/boards", {
            boardNo: 5,
            title: "꽃잎 한 장처럼",
            content: "수도생활 50년, 좋은 삶과 관계를 위한 통찰",
            writer: "이해인",
            regDate: "2020-05-25T09:00",
          })
          .then((response) => {
            if (!response.ok) throw new Error(response.statusText);
            return response.text();
          })
          .then((msg) => console.log(msg))
          .catch((err) => console.error(err));
      }

      function deleteData() {
        ajaxrequest
          .delete("http://localhost:8088/boards/5")
          .then((response) => {
            if (!response.ok) throw new Error(response.statusText);
            return response.text();
          })
          .then((msg) => console.log(msg))
          .catch((err) => console.error(err));
      }
    </script>
  </body>
</html>
